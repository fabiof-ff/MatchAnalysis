<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Analysis - Analisi Video Calcio</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- YouTube API -->
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <div class="container">
        <div class="header-bar">
            <h1>Match Analysis</h1>
            <div class="tabs-navigation">
                <button class="tab-btn active" data-tab="analysis">üìä Analisi Video</button>
                <button class="tab-btn" data-tab="live">üî¥ Live Tagging</button>
                <button class="tab-btn" data-tab="tools">üõ†Ô∏è Strumenti Video</button>
            </div>
        </div>

        <!-- Tab: Analisi Video -->
        <div class="tab-content active" id="analysis-tab">
        <div class="main-content" id="mainContent">
            <!-- Sezione Tags -->
            <div class="tags-section" id="tagsSection">
                <div class="collapsed-label">TAGS</div>
                <div class="tag-panel" style="padding: 10px;">
                    <div class="tag-creation" style="display: flex; align-items: center; gap: 5px; margin-bottom: 12px;">
                        
                        <div class="actions-toolbar" style="margin: 0; display: flex; gap: 4px; flex-shrink: 0;">
                            <button id="exportTagsJSONBtn" title="Esporta Tag JSON" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; color: white;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1-2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                            </button>
                            <label for="importTagsJSONInput" class="import-btn" title="Importa Tag JSON" style="background: linear-gradient(135deg, #16a085, #138d75); border-radius: 4px; color: white; padding: 4px 8px; cursor: pointer; display: flex; align-items: center;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                <input type="file" id="importTagsJSONInput" accept=".json" style="display: none;">
                            </label>
                        </div>

                        <div style="height: 20px; width: 1px; background: #ccc; margin: 0 2px; flex-shrink: 0;"></div>

                        <input type="text" id="newTagName" placeholder="Tag..." style="flex: 1; min-width: 50px;">
                        <select id="tagPhaseInput" style="padding: 4px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.85em; flex-shrink: 0;">
                            <option value="offensiva">üî• OFF</option>
                            <option value="difensiva">üõ°Ô∏è DIF</option>
                        </select>
                        <button id="addTagBtn" style="flex-shrink: 0;">+</button>
                    </div>
                    
                    <div class="tags-container-split" style="display: flex; gap: 10px;">
                        <div class="phase-group" style="flex: 1;">
                            <h3 style="margin: 0 0 8px 0; font-size: 0.9em; color: #27ae60; font-weight: 800; border-bottom: 2px solid #27ae60; padding-bottom: 2px; text-align: center;">FASE OFFENSIVA</h3>
                            <div class="tag-list" id="tagListOffensive">
                                <!-- Tags offensive -->
                            </div>
                        </div>
                        <div class="phase-group" style="flex: 1;">
                            <h3 style="margin: 0 0 8px 0; font-size: 0.9em; color: #e74c3c; font-weight: 800; border-bottom: 2px solid #e74c3c; padding-bottom: 2px; text-align: center;">FASE DIFENSIVA</h3>
                            <div class="tag-list" id="tagListDefensive">
                                <!-- Tags difensive -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nuovo Sottopannello: Eventi Match -->
                <div class="tag-panel" style="padding: 10px; border-top: 2px solid #ddd; flex: 1; display: flex; flex-direction: column; min-height: 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; font-weight: bold; margin-bottom: 5px; font-size: 0.8em; color: #7f8c8d;">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="text" id="teamNameA" value="SQUADRA A" style="border: none; background: #f0f0f0; text-align: center; font-weight: bold; color: #2c3e50; font-size: 1em; width: 0; flex: 1; outline: none; border-radius: 4px; padding: 2px;" oninput="updateTeamName('A', this.value, 'analysis')">
                            <input type="color" id="teamColorPickerA" title="Colore Squadra A" style="width: 22px; height: 22px; padding: 0; border: none; border-radius: 4px; cursor: pointer; background: transparent; flex-shrink: 0;" oninput="updateLiveTeamColor('A', this.value, 'analysis')">
                        </div>
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="text" id="teamNameB" value="SQUADRA B" style="border: none; background: #f0f0f0; text-align: center; font-weight: bold; color: #2c3e50; font-size: 1em; width: 0; flex: 1; outline: none; border-radius: 4px; padding: 2px;" oninput="updateTeamName('B', this.value, 'analysis')">
                            <input type="color" id="teamColorPickerB" title="Colore Squadra B" style="width: 22px; height: 22px; padding: 0; border: none; border-radius: 4px; cursor: pointer; background: transparent; flex-shrink: 0;" oninput="updateLiveTeamColor('B', this.value, 'analysis')">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex: 1; overflow-y: auto; align-content: start;">
                        <div id="tagListA" class="tag-list-column"></div>
                        <div id="tagListB" class="tag-list-column"></div>
                    </div>
                </div>
            </div>

            <!-- Sezione Video Player -->
            <div class="video-section">
                <div class="video-controls-top" style="display: flex; gap: 6px; align-items: center; flex-wrap: wrap; background: #f8f9fa; padding: 5px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #dee2e6; margin-top: -14px;">
                    <!-- Pulsanti espansione pannelli laterali -->
                    <button id="toggleTagsSidebarBtn" class="toolbar-side-btn" onclick="toggleTagsPanel()" title="Espandi/Compatta Pannello Tag">¬´ TAGS</button>
                    
                    <div style="height: 24px; width: 1px; background: #ccc; margin: 0 4px;"></div>

                    <button id="loadVideoBtn" title="Carica Video Locale" style="background: linear-gradient(135deg, #3498db, #2980b9); display: flex; align-items: center; padding: 6px 10px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                    </button>
                    <button id="loadVideoUrlBtn" title="Carica Video da URL" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); display: flex; align-items: center; padding: 6px 10px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                    </button>
                    <button id="exportFFmpegBtn" title="Esporta Script FFmpeg" style="background: linear-gradient(135deg, #e67e22, #d35400); display: flex; align-items: center; padding: 6px 10px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                    </button>
                    
                    <div style="height: 24px; width: 1px; background: #ccc; margin: 0 4px;"></div>

                    <div class="xfade-control" style="display: flex; align-items: center; gap: 5px; background: #34495e; padding: 4px 8px; border-radius: 5px; color: white;">
                        <span title="Durata Sfumatura" style="font-size: 0.75em; font-weight: 600;">‚òÅÔ∏è</span>
                        <select id="xfadeDuration" style="background: white; color: #333; border: none; border-radius: 3px; padding: 2px; font-size: 0.75em; cursor: pointer;">
                            <option value="0">Off</option>
                            <option value="0.3">0.3s</option>
                            <option value="0.5" selected>0.5s</option>
                            <option value="0.8">0.8s</option>
                            <option value="1.0">1.0s</option>
                            <option value="1.5">1.5s</option>
                        </select>
                    </div>

                    <div class="mute-control" style="display: flex; align-items: center; gap: 5px; background: #34495e; padding: 4px 8px; border-radius: 5px; color: white;">
                        <input type="checkbox" id="muteExportAudio" style="cursor: pointer;">
                        <span title="Disattiva Audio Export" style="font-size: 0.75em; font-weight: 600;">üîá</span>
                    </div>

                    <button id="startPreviewFromMainBtn" title="Avvia Sequenza Anteprima" style="background: linear-gradient(135deg, #27ae60, #2ecc71); display: flex; align-items: center; padding: 6px 10px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    </button>
                    <button id="stopPreviewMainBtn" title="Ferma Sequenza" style="background: linear-gradient(135deg, #e74c3c, #c0392b); display: none; align-items: center; padding: 6px 10px; border: none; border-radius: 5px; color: white; cursor: pointer;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12"></rect></svg>
                    </button>

                    <div style="height: 24px; width: 1px; background: #ccc; margin: 0 4px;"></div>

                    <!-- Inizio Frazioni compatta -->
                    <div class="match-times-compact" style="display: flex; align-items: center; gap: 8px; background: #fdf2e9; padding: 4px 10px; border-radius: 5px; border: 1px solid #f8c471;">
                        <span title="Inizio Frazioni (Export TXT)" style="font-size: 0.85em;">‚è±Ô∏è</span>
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <span style="font-size: 0.7em; color: #7f8c8d; font-weight: bold;">1¬∞T</span>
                            <input type="text" id="matchStart1" value="00:00" placeholder="00:00" style="width: 45px; padding: 2px; border-radius: 3px; border: 1px solid #ccc; text-align: center; font-size: 0.8em;">
                            
                            <span style="font-size: 0.7em; color: #7f8c8d; font-weight: bold; margin-left: 4px;">2¬∞T</span>
                            <input type="text" id="matchStart2" value="45:00" placeholder="45:00" style="width: 45px; padding: 2px; border-radius: 3px; border: 1px solid #ccc; text-align: center; font-size: 0.8em;">
                        </div>
                    </div>

                    <div style="height: 24px; width: 1px; background: #ccc; margin: 0 4px;"></div>
                    
                    <button id="toggleActionsSidebarBtn" class="toolbar-side-btn" onclick="toggleActionsPanel()" title="Espandi/Compatta Pannello Azioni">AZIONI ¬ª</button>
                </div>

                <div id="videoContainer" style="width: 100%; position: relative; border-radius: 8px; overflow: hidden; background: #000;">
                    <video id="videoPlayer" controls style="width: 100%; max-height: 500px; display: block;">
                        Il tuo browser non supporta il video HTML5.
                    </video>
                    <div id="youtubePlayer" style="display: none; width: 100%; height: 500px;"></div>
                </div>
                
                <div class="video-info">
                    <span id="currentTime">00:00:00</span>
                    <span id="duration">00:00:00</span>
                </div>

                <!-- Anteprima Azioni Selezionate (per modal o export) -->
                <div id="selectedActionsPreview" style="display: none;"></div>
                
                <!-- Slider per controllo azione attiva -->
                <div id="actionSliderContainer" class="action-slider-container" style="display: none;">
                    <div class="slider-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <span id="activeActionName">Nessuna azione selezionata</span>
                        <div class="slider-timer">
                            <span id="startTimeDisplay">00:00.0</span> - <span id="endTimeDisplay">00:00.0</span>
                        </div>
                    </div>
                    
                    <div class="slider-controls-group" style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                        <div class="step-controls">
                            <div style="display: flex; gap: 2px;">
                                <button id="startTimeMinus" class="step-btn" title="-0.5s Inizio">-</button>
                                <button id="startTimePlus" class="step-btn" title="+0.5s Inizio">+</button>
                            </div>
                        </div>

                        <div class="dual-range-wrapper" style="flex: 1;">
                            <div class="slider-track"></div>
                            <input type="range" id="startTimeSlider" class="range-input" min="0" max="100" step="0.1" value="0">
                            <input type="range" id="endTimeSlider" class="range-input" min="0" max="100" step="0.1" value="100">
                        </div>

                        <div class="step-controls">
                            <div style="display: flex; gap: 2px;">
                                <button id="endTimeMinus" class="step-btn" title="-0.5s Fine">-</button>
                                <button id="endTimePlus" class="step-btn" title="+0.5s Fine">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Albero delle Azioni Taggate -->
            <div class="tagged-actions-section" id="actionsSection">
                <div class="collapsed-label">AZIONI TAGGATE</div>
                <div class="tagged-actions-header" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 5px;">
                    <!-- Totale tempo azioni selezionate -->
                    <div id="totalSelectedTime" style="text-align: center; font-size: 0.8em; color: #2c3e50; font-weight: bold; background: #e8f4f8; padding: 4px 8px; border-radius: 4px; margin-bottom: 5px; border: 1px solid #bde0eb; display: flex; justify-content: space-between; align-items: center; gap: 5px;">
                        <span id="totalOverall" title="Totale complessivo selezionato">TOT: 00:00:00</span>
                        <span id="totalOffensive" style="color: #27ae60;" title="Totale fase offensiva">OFF: 00:00:00</span>
                        <span id="totalDefensive" style="color: #e74c3c;" title="Totale fase difensiva">DIF: 00:00:00</span>
                    </div>
                    <div class="row1" style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: flex-start;">
                        <button id="filterSelectedBtn" onclick="toggleSelectedFilter()" title="Mostra solo selezionate" style="padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; background: #95a5a6; color: white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        </button>
                        <button id="selectAllBtn" title="Seleziona Tutte" style="padding: 6px 10px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><polyline points="9 11 12 14 22 4"></polyline></svg>
                        </button>
                        <button id="deselectAllBtn" title="Deseleziona Tutte" style="padding: 6px 10px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="9" x2="15" y2="15"></line><line x1="15" y1="9" x2="9" y2="15"></line></svg>
                        </button>
                        <button id="deleteSelectedBtn" title="Elimina Selezionati" style="background: linear-gradient(135deg, #e74c3c, #c0392b); padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>
                        <button id="filterFlagBtn" onclick="toggleFlagFilterPanel()" title="Filtra per Flag" style="background: linear-gradient(135deg, #34495e, #2c3e50); padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </button>
                        <div class="filter-tags-container" style="display: inline-block;">
                            <button id="toggleFilterBtn" title="Filtra per Tag" style="padding: 6px 10px; display: flex; align-items: center; gap: 4px; border: 1px solid #ccc; border-radius: 5px; background: #ecf0f1; color: #2c3e50; cursor: pointer;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle;"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                                <span style="font-weight: bold; margin-left: 2px;">Tag</span>
                            </button>
                            <div id="filterTagsPanel" class="filter-tags-panel" style="display: none;">
                                <!-- I checkbox per i tag appariranno qui -->
                            </div>
                        </div>
                    </div>
                    <div class="row2" style="display: flex; gap: 5px; flex-wrap: wrap;">
                        <button id="toggleViewModeBtn" onclick="toggleViewMode()" title="Visualizzazione Libera (Lista Unica / Ordine Libero)" style="padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; background: #8e44ad; color: white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line></svg>
                        </button>
                        <button id="collapseAllBtn" title="Compatta/Espandi Tutti" style="padding: 6px 10px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                        </button>
                        <button id="toggleAllCommentsBtn" onclick="toggleAllComments()" title="Mostra/Nascondi tutti i commenti" style="padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; background: #3498db; color: white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        </button>
                        <button id="addImageActionBtn" title="Aggiungi Slide/Immagine" style="background: linear-gradient(135deg, #2980b9, #3498db); padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; color: white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            <input type="file" id="addImageActionInput" accept="image/*" style="display: none;">
                        </button>
                        <button id="exportActionsJSONBtn" title="Esporta Azioni JSON" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        </button>
                        <button id="exportActionsTXTBtn" title="Esporta Elenco TXT" style="background: linear-gradient(135deg, #34495e, #2c3e50); padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; color: white;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                        </button>
                        <label for="importActionsJSONInput" class="import-btn" title="Importa Azioni JSON" style="background: linear-gradient(135deg, #16a085, #138d75); border-radius: 5px; color: white; padding: 6px 10px; cursor: pointer; display: flex; align-items: center;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            <input type="file" id="importActionsJSONInput" accept=".json" style="display: none;">
                        </label>
                    </div>
                </div>

                <!-- selection-tools rimosso perch√© incorporato sopra -->
            <div id="actionsList" class="actions-list">
                <!-- Le azioni taggate appariranno qui -->
            </div>
        </div>
        </div>

        </div>
        <!-- Fine Tab Analisi Video -->

        <!-- Tab: Live Tagging -->
        <div class="tab-content" id="live-tab">
            <div class="live-container">
                <div class="live-header">
                    <div class="live-score-row">
                        <button id="liveGolBtnA" class="live-gol-btn" title="Click: +1 | Pressione lunga: -1">GOL</button>
                        <div class="live-timer-score-container">
                            <div class="live-timer-display" id="liveTimerDisplay">00:00</div>
                            <div class="live-score-display" onclick="resetScore()" title="Clicca per resettare">
                                <span id="scoreA">0</span> - <span id="scoreB">0</span>
                            </div>
                        </div>
                        <button id="liveGolBtnB" class="live-gol-btn" title="Click: +1 | Pressione lunga: -1">GOL</button>
                    </div>

                    <div class="live-timer-controls">
                        <button onclick="modifyLiveTimer(-10)" class="live-ctrl-btn step">-10s</button>
                        <button id="liveStartBtn" class="live-ctrl-btn start">AVVIA</button>
                        <button id="livePauseBtn" class="live-ctrl-btn pause" style="display:none;">PAUSA</button>
                        <button onclick="modifyLiveTimer(10)" class="live-ctrl-btn step">+10s</button>
                        <button id="liveResetBtn" class="live-ctrl-btn reset">RESET</button>
                        <button id="liveSet45Btn" class="live-ctrl-btn set-time">45:00</button>
                        <button onclick="exportActionsToJSON('live')" class="live-ctrl-btn json-btn">JSON</button>
                    </div>
                </div>

                <div class="live-main-grid">
                    <div class="live-tag-column">
                        <div id="liveTagListOffensive" class="live-tag-list"></div>
                    </div>
                    <div class="live-tag-column">
                        <div id="liveTagListDefensive" class="live-tag-list"></div>
                    </div>
                    <div class="live-teams-row">
                        <div class="live-tag-column">
                            <div class="live-column-header">
                                <input type="text" class="live-team-input" value="SQUADRA A" oninput="updateTeamName('A', this.value, 'live')" data-team="A">
                                <input type="color" class="live-team-color" oninput="updateLiveTeamColor('A', this.value, 'live')" data-team="A" title="Colore Squadra A">
                            </div>
                            <div id="liveTagListA" class="live-tag-list"></div>
                        </div>
                        <div class="live-tag-column">
                            <div class="live-column-header">
                                <input type="text" class="live-team-input" value="SQUADRA B" oninput="updateTeamName('B', this.value, 'live')" data-team="B">
                                <input type="color" class="live-team-color" oninput="updateLiveTeamColor('B', this.value, 'live')" data-team="B" title="Colore Squadra B">
                            </div>
                            <div id="liveTagListB" class="live-tag-list"></div>
                        </div>
                    </div>
                </div>

                <div class="live-footer">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                        <h3 class="live-footer-title" style="margin: 0;">ULTIME AZIONI</h3>
                        <button id="clearAllActionsBtn" onclick="clearAllActions()" title="Elimina tutte le azioni" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.75em; display: flex; align-items: center; gap: 4px;">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            ELIMINA TUTTO
                        </button>
                    </div>
                    <div id="liveActionsList" class="live-actions-list"></div>
                </div>
            </div>
        </div>

        <!-- Tab: Strumenti Video -->
        <div class="tab-content" id="tools-tab">
        
        <!-- Sezione Merge Video -->
        <div class="merge-section" style="margin: 20px;">
            <h2>üé¨ Merge Video Multipli</h2>
            <p class="merge-description">Unisci pi√π file video in un unico file (es. primo tempo + secondo tempo)</p>
            <div class="merge-controls">
                <input type="file" id="mergeVideosInput" accept="video/*" multiple>
                <button id="selectMergeVideosBtn">Seleziona Video da Unire</button>
                <button id="exportMergeBtn" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">üîó Genera Script Merge</button>
            </div>
            <div id="mergeVideosList" class="merge-videos-list">
                <!-- Lista video da unire -->
            </div>
        </div>

        <!-- Sezione Compressione Video -->
        <div class="compress-section">
            <h2>üóúÔ∏è Comprimi Video</h2>
            <p class="compress-description">Riduci le dimensioni di un video mantenendo una buona qualit√†</p>
            <div class="compress-controls">
                <input type="file" id="compressVideoInput" accept="video/*">
                <button id="selectCompressVideoBtn">Seleziona Video da Comprimere</button>
                
                <div class="compress-options">
                    <label>
                        <span>Qualit√†:</span>
                        <select id="compressionQuality">
                            <option value="high">Alta (CRF 20 - file pi√π grande)</option>
                            <option value="medium" selected>Media (CRF 23 - bilanciato)</option>
                            <option value="low">Bassa (CRF 28 - file pi√π piccolo)</option>
                            <option value="verylow">Molto Bassa (CRF 32 - compressione massima)</option>
                        </select>
                    </label>
                    
                    <label>
                        <span>Risoluzione:</span>
                        <select id="compressionResolution">
                            <option value="original" selected>Originale</option>
                            <option value="1080">1080p (Full HD)</option>
                            <option value="720">720p (HD)</option>
                            <option value="480">480p (SD)</option>
                        </select>
                    </label>
                </div>
                
                <button id="exportCompressBtn" style="background: linear-gradient(135deg, #8e44ad, #9b59b6);">üóúÔ∏è Genera Script Compressione</button>
            </div>
            <div id="compressVideoInfo" class="compress-video-info">
                <!-- Info video da comprimere -->
            </div>
        </div>
        
        </div>
        <!-- Fine Tab Strumenti Video -->

    </div>

    <!-- Modal AI Comment -->
    <div id="aiCommentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                <h2 style="margin: 0; color: #2c3e50; font-size: 1.5em;">ü™Ñ Assistente AI - Analisi Clip</h2>
                <span class="close" onclick="closeAICommentModal()" style="cursor: pointer; font-size: 28px; font-weight: bold; color: #aaa;">&times;</span>
            </div>
            <div class="modal-body">
                <div id="aiInputSection">
                    <p style="margin-bottom: 15px; color: #7f8c8d;">Inserisci una descrizione dettagliata dell'azione. L'AI generer√† una sintesi tecnica di massimo 12 parole per i commenti.</p>
                    <textarea id="aiInputDescription" placeholder="Es: Il giocatore riceve palla tra le linee, salta l'uomo e serve l'attaccante in profondit√† che calcia a rete..." rows="5" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; margin-bottom: 15px; resize: vertical; outline: none; transition: border-color 0.3s;"></textarea>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span id="aiUsageIndicator" style="font-size: 0.8em; color: #95a5a6;">Utilizzo oggi: 0 / 1500</span>
                        <div style="display: flex; gap: 10px;">
                              <button class="modal-btn-ai" style="padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; transition: all 0.3s; background: #95a5a6;" onclick="closeAICommentModal()">Annulla</button>
                              <button id="generateAIBtn" class="modal-btn-ai" style="padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; transition: all 0.3s; background: linear-gradient(135deg, #9b59b6, #8e44ad);" onclick="processAIComment()">Genera Sintesi</button>
                        </div>
                    </div>
                </div>

                <div id="aiResultSection" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                    <p style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">Sintesi Proposta dall'AI:</p>
                    <textarea id="aiResultText" rows="3" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #9b59b6; font-family: inherit; margin-bottom: 15px; resize: vertical; outline: none; background: #fdf7ff; font-style: italic;"></textarea>
                    <div style="display: flex; justify-content: flex-end; gap: 10px;">
                        <button class="modal-btn-ai" style="padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; background: #95a5a6;" onclick="resetAIModal()">Riprova</button>
                        <button id="applyAIResultBtn" class="modal-btn-ai" style="padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; background: linear-gradient(135deg, #27ae60, #2ecc71);" onclick="confirmAIComment()">Conferma e Applica</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="export.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
